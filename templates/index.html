<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NYC Crash Dashboard</title>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background: #f7f7f7;
        }

        h1 {
            text-align: center;
            color: #222;
        }

        .filter-box {
            width: 90%;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        select, input {
            padding: 10px;
            width: 100%;
            border-radius: 6px;
            border: 1px solid #aaa;
            font-size: 14px;
        }

        button {
            padding: 12px;
            grid-column: span 4;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .chart-box {
            width: 95%;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        h2 {
            text-align: center;
            color: #333;
        }
    </style>

</head>
<body>

<h1>NYC Crash Interactive Dashboard</h1>

<form method="POST">
    <div class="filter-box">

        <!-- BOROUGH -->
        <div>
            <label>Borough</label>
            <select name="borough">
                <option>All</option>
                {% for b in boroughs %}
                <option value="{{b}}" {% if selected_borough == b %}selected{% endif %}>{{ b }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- YEAR -->
        <div>
            <label>Year</label>
            <select name="year">
                <option>All</option>
                {% for y in years %}
                <option value="{{y}}" {% if selected_year == y %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- SEARCH -->
        <div>
            <label>Search Mode</label>
            <input type="text" name="search" placeholder="e.g. Brooklyn 2020 pedestrian">
        </div>

        <!-- BUTTON -->
        <button type="submit">Generate Report</button>

    </div>
</form>

<!-- ===================== -->
<!-- CHARTS SECTION -->
<!-- ===================== -->

<div class="chart-box">
    <h2>Top Vehicle Types</h2>
    <div id="bar"></div>
</div>

<div class="chart-box">
    <h2>Injuries vs Fatalities</h2>
    <div id="pie"></div>
</div>

<div class="chart-box">
    <h2>Crash Locations</h2>
    <div id="map"></div>
</div>

<div class="chart-box">
    <h2>Crashes Per Year</h2>
    <div id="line"></div>
</div>

<div class="chart-box">
    <h2>Injuries by Borough × Year</h2>
    <div id="heat"></div>
</div>

<div class="chart-box">
    <h2>Distribution of Injuries</h2>
    <div id="hist"></div>
</div>

<div class="chart-box">
    <h2>Scatter: Injuries vs Fatalities</h2>
    <div id="scatter"></div>
</div>

<div class="chart-box">
    <h2>Sunburst: Borough → Vehicle Type → Injuries</h2>
    <div id="sunburst"></div>
</div>

<!-- ===================== -->
<!-- PLOTLY JS RENDERING -->
<!-- ===================== -->

<script>
    var bar_fig = {{ bar | safe }};
    Plotly.newPlot("bar", bar_fig.data, bar_fig.layout);

    var pie_fig = {{ pie | safe }};
    Plotly.newPlot("pie", pie_fig.data, pie_fig.layout);

    var map_fig = {{ map | safe }};
    Plotly.newPlot("map", map_fig.data, map_fig.layout);

    var line_fig = {{ line | safe }};
    Plotly.newPlot("line", line_fig.data, line_fig.layout);

    var heat_fig = {{ heat | safe }};
    Plotly.newPlot("heat", heat_fig.data, heat_fig.layout);

    var hist_fig = {{ hist | safe }};
    Plotly.newPlot("hist", hist_fig.data, hist_fig.layout);

    var scatter_fig = {{ scatter | safe }};
    Plotly.newPlot("scatter", scatter_fig.data, scatter_fig.layout);

    var sun_fig = {{ sunburst | safe }};
    Plotly.newPlot("sunburst", sun_fig.data, sun_fig.layout);
</script>

</body>
</html>
